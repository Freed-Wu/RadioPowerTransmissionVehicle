RadioPowerTransmissionVehicle
=============================

This is a program used for car which work by radio power. Just for reference.

无线电能传输小车
================

功能实现
--------

软件分为2个模块，分别对应基本要求和发挥要求;

### 基础部分

用接线帽将P6.5和3V3导通时进入第1模块。

#### 第一状态

先是第1状态，在中断中通过电流传感器检测是否处于充电状态，处于时LED1闪烁; 否则小车启动。

#### 第二状态

然后是第2状态，在中断中通过电流传感器检测是否处于充电状态，处于时小车停止。

1.  如果小车停止对应 **基本要求2:小车放置在 A 点， 接通电源充电，60 秒时断开电源，小车检测到发射线 圈停止工作自行起动，沿引导线行驶至 B 点并自动停车。**
2.  如果小车一直行驶，直到电力不足停止，对应 **基本要求3:小车放置在 A 点， 接通电源充电，60 秒时断开电源，小车检测到发射线 圈停止工作自行起动，沿引导线行驶直至停车（行驶期间，4 个发射线 圈均不工作） ，测量小车行驶距离 L1 ，L1 越大越好。**

### 发挥部分

用接线帽将P6.5和GND导通时进入第2模块。 通过RC硬件实现延时60秒后启动小车;

小车检测到靠近充电站时低速行驶，离开时高速行驶; 直至断电。满足 **发挥部分：小车放置在 A 点，接通电源充电并开始计时；60 秒时，小车自行起动 （小车超过 60 秒起动按超时时间扣分） ，沿引导线单向不停顿行驶直至 停车 （沿途由 4 个发射线圈轮流动态充电） ； 180 秒时， 如小车仍在行驶， 则断开电源，直至停车。测量小车行驶距离 L 2 ，计算 L=L 2 -L 1 ，L 越大越 好。 （2） 在发挥部分 （1） 测试中， 测量直流稳压电源在小车开始充电到停驶时间 段内输出的电能 W，计算 K= L 2 /W，K 越大越好。**

第2模块下，LED2闪烁表示充电。满足 **基本要求1:小车能通过声或光显示是否处在充电状态。**,同时可以通过LED1还是LED2的闪烁 *判断处于哪一个模块* 。

软件设计
--------

### 设计目标

  设计目标     实现思路
  ------------ ------------------------
  *省电*       低功耗模式
  *便于维护*   通过LED灯显示运行状态;

### 程序流程

1.  检测P6.5 判断处于哪一模块;
2.  初始化;
3.  进入低功耗模式3，仅ACLK时钟服务的2路PWM可用，默认状态下顺时针转弯。转弯半径待调。关闭其他外设、时钟;
4.  通过电流传感器检测充电状态变化的中断和循迹传感器的中断唤醒。执行指令后，退出中断，继续休眠模式。

*注意，正常情况下如果行驶轨迹的圆非常标准，转弯半径调整正确，不应触发循迹传感器的中断。当轨迹出现偏差时通过该中断校准。*

*另外，考虑到低功耗，不使用编码器测量速度进行PID调节。*

*MSP430的程序可以使用王宏波老师的书的例程。*

开发约定
--------

### 软件平台

CCS v9.1

### 硬件平台

  硬件平台   名称
  ---------- -------------------
  MCU        MSP430F5529
  PCB        EXP-MSP430F5529LP

### 目录结构

``` {.{.{.{.{.{.{.{.{.{.{.{.{.{.{text}}}}}}}}}}}}}}}

├─ car/         项目文件名
    ├─ cmd/     链接器配置文件
    ├─ src/     源文件
    └─ include/ 头文件
```

### 硬件连线

``` {.{.{.{.{.{.{text}}}}}}}
    -------------------
/|\|                   |
 | |                   |
 --|RST                |
   |               P1.2|--> 左边电机PWM
   |                   |
   |               P1.3|--> 右边电机PWM
   |               P6.5|--> 接线帽
   |                   |
   |               P6.1|--> 避障最左
   |               P6.2|--> 避障左中
   |               P6.3|--> 避障右中
   |               P6.4|--> 避障最右
   |                   |
   |                 5V|--> ＋
   |                GND|--> －
   |                   |
    -------------------
```

### 字符编码

cp936(gbk)

### 代码要求 ###

磨刀不误砍柴功，勤写注释早脱单。

开发计划
--------

### 时间节点

待议。

*开发阶段时可以考虑通过ADC检测剩余电量，通过串口发送回上位机来分析数据以改进算法。发布阶段通过条件编译不运行该模块代码以省电。如果开发时间不允许放弃该计划。*

### 人员安排

1.  Taotao 和我编写MSP430的代码和调试程序。
2.  硬件和结构以及TMS320的代码由Leo 全权负责。
3.  设计报告前期由Leo 全权负责。后期由老师和我们一起审核。*报告排版考虑考虑latex？*
